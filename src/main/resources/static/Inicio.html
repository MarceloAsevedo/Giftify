<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Giftify</title>
  <link rel="stylesheet" href="giftifyestilo.css">
</head>
<body>
<header class="header">
  <div class="logo">
    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon">
      <rect x="3" y="8" width="18" height="4" rx="1"></rect>
      <path d="M12 8v13"></path>
      <path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"></path>
      <path d="M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5"></path>
    </svg>
    <span>LOGO</span>
  </div>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon">
    <line x1="4" x2="20" y1="12" y2="12"></line>
    <line x1="4" x2="20" y1="6" y2="6"></line>
    <line x1="4" x2="20" y1="18" y2="18"></line>
  </svg>
</header>
<div class="container">
  <aside class="sidebar">
    <nav>
      <button class="button" onclick="location.href='inicio.html'">Inicio</button>
      <button class="button" onclick="location.href='perfil.html'">Perfil</button>
      <button class="button" onclick="location.href='publicar.html'">Publicar</button>
      <button class="button" onclick="location.href='buscar.html'">Buscar</button>
      <button class="button" onclick="location.href='mensajes.html'">Mensajes</button>
      <button class="button" onclick="location.href='Listadeseos.html'">Mis Listas</button>
      <button class="button" onclick="location.href='notificaciones.html'">Notificaciones</button>
      <button class="button" onclick="location.href='seguridadyprivacidad.html'">Seguridad y privacidad</button>
      <button class="button" onclick="location.href='editarperfil.html'">Editar perfil</button>
      <button class="button" id="logoutButton">Cerrar Sesión</button>
    </nav>
  </aside>
  <main>
    <div id="publicaciones"></div>
  </main>
</div>
<script src="cerrarSesion.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
   const usuarioStr = sessionStorage.getItem('usuario');
   if (!usuarioStr) {
     alert('No se encontró el objeto de usuario en sessionStorage');
     return;
   }

   const usuario = JSON.parse(usuarioStr);
   const userId = usuario.id;

   // Realizar fetch para obtener las publicaciones del inicio (incluyendo las del usuario logueado)
   fetch(`http://localhost:8082/publicaciones/inicio/${userId}`)
     .then(response => {
       if (!response.ok) {
         throw new Error('Error en la respuesta de la red');
       }
       return response.json();
     })
     .then(data => {
       const publicacionesDiv = document.getElementById('publicaciones');
       if (data.length === 0) {
         publicacionesDiv.innerHTML = '<p>No hay publicaciones disponibles.</p>';
         return;
       }

       data.forEach(publicacion => {
         const pubDiv = document.createElement('div');
         pubDiv.className = 'publicacion';
         pubDiv.innerHTML = `
           <div class="perfil-info">
             ${publicacion.fotoPerfil ? `<img src="${publicacion.fotoPerfil}" alt="Foto de perfil">` : ''}
             <p>${publicacion.nombrePerfil} ${publicacion.apellidoPerfil}</p>
           </div>
           <div class="publicacion-descripcion">
             <p>${publicacion.descripcionPublicacion}</p>
           </div>
           ${publicacion.fotoPublicacion ? `
             <div class="publicacion-foto">
               <img src="${publicacion.fotoPublicacion}" alt="Foto de la publicación">
             </div>` : ''}
           <div class="publicacion-fecha">
             <p>${new Date(publicacion.fechaHoraPublicado).toLocaleString()}</p>
           </div>
         `;
         publicacionesDiv.appendChild(pubDiv);
       });
     })
     .catch(error => {
       console.error('Error al obtener publicaciones:', error);
       document.getElementById('publicaciones').innerHTML = '<p>Error al cargar publicaciones. Inténtalo más tarde.</p>';
     });
 });

</script>
</body>
</html>
